import {
  ApolloLink,
  CombinedGraphQLErrors,
  Observable,
  isNonNullObject,
  print
} from "./chunk-2OH64IG6.js";
import "./chunk-AADGAENQ.js";
import "./chunk-QF73RJPA.js";
import "./chunk-G3PMV62Z.js";

// node_modules/.pnpm/@apollo+client@4.0.11_graphql-ws@6.0.6_crossws@0.4.1_srvx@0.9.7__graphql@16.12.0_ws@8.1_26bc679fbdfe5d5fe1646717d26c9d0a/node_modules/@apollo/client/link/subscriptions/index.js
function isLikeCloseEvent(val) {
  return isNonNullObject(val) && "code" in val && "reason" in val;
}
function isLikeErrorEvent(err) {
  return isNonNullObject(err) && err.target?.readyState === WebSocket.CLOSED;
}
var GraphQLWsLink = class extends ApolloLink {
  client;
  constructor(client) {
    super();
    this.client = client;
  }
  request(operation) {
    return new Observable((observer) => {
      const { query, variables, operationName, extensions } = operation;
      return this.client.subscribe({ variables, operationName, extensions, query: print(query) }, {
        next: observer.next.bind(observer),
        complete: observer.complete.bind(observer),
        error: (err) => {
          if (err instanceof Error) {
            return observer.error(err);
          }
          const likeClose = isLikeCloseEvent(err);
          if (likeClose || isLikeErrorEvent(err)) {
            return observer.error(
              // reason will be available on clean closes
              new Error(`Socket closed${likeClose ? ` with event ${err.code}` : ""}${likeClose ? ` ${err.reason}` : ""}`)
            );
          }
          return observer.error(new CombinedGraphQLErrors({
            errors: Array.isArray(err) ? err : [err]
          }));
        }
        // casting around a wrong type in graphql-ws, which incorrectly expects `Sink<ExecutionResult>`
      });
    });
  }
};
export {
  GraphQLWsLink
};
//# sourceMappingURL=@apollo_client_link_subscriptions.js.map
